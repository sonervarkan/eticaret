use webprogramlamaeticaret;


CREATE TABLE stoklar(
    stok_id int primary key auto_increment,
    stok_miktari int NOT NULL,
    urunId int NOT NULL,
    FOREIGN KEY (urunId) REFERENCES urunler(urun_id)
);

CREATE TABLE urunler(
    urun_id int primary key auto_increment,
    urun_aciklama varchar(250),
    urun_fiyati DECIMAL(10, 2) NOT NULL,
    urun_resim_url varchar(100) NOT NULL,
    indirimli_fiyat DECIMAL(10,2) DEFAULT NULL,
    markaId int,
    modelId int,
    kategoriId int,
    FOREIGN KEY (markaId) REFERENCES markalar(marka_id),
    FOREIGN KEY (modelId) REFERENCES modeller(model_id),
    FOREIGN KEY (kategoriId) REFERENCES kategoriler(kategori_id)
);

CREATE TABLE kategoriler(
    kategori_id int primary key auto_increment,
    kategori_adi varchar(30) 
);

CREATE TABLE musteriler(
    musteri_id int primary key auto_increment,
    musteri_adi varchar(40) NOT NULL,
    musteri_soyadi varchar(50) NOT NULL,
    sifre varchar(150),
    musteri_email varchar(40) NOT NULL UNIQUE,
    musteri_tel varchar(40) NOT NULL UNIQUE,
    musteri_adres varchar(200) NOT NULL
);

CREATE TABLE siparisler (
  siparis_id INT AUTO_INCREMENT PRIMARY KEY,
  musteriId INT NOT NULL,
  siparis_tarihi TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  toplam_fiyat DECIMAL(10, 2) NOT NULL,
  durum VARCHAR(50) NOT NULL,  -- veya TEXT
  FOREIGN KEY (musteriId) REFERENCES musteriler(musteri_id)
);

CREATE TABLE siparis_detay (
  siparisDetay_id INT AUTO_INCREMENT PRIMARY KEY,
  siparisId INT NOT NULL,
  urunId INT NOT NULL,
  adet INT NOT NULL,
  birim_fiyat DECIMAL(10, 2) NOT NULL,
  FOREIGN KEY (siparisId) REFERENCES siparisler(siparis_id) ON DELETE CASCADE,
  FOREIGN KEY (urunId) REFERENCES urunler(urun_id) ON DELETE CASCADE
);

CREATE TABLE sepet (
    sepet_id INT PRIMARY KEY AUTO_INCREMENT,
    musteriId INT NOT NULL,
    urunId INT NOT NULL,
    siparisId int NOT NULL,
    adet INT NOT NULL,
    eklenme_tarihi TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (musteriId) REFERENCES musteriler(musteri_id),
    FOREIGN KEY (urunId) REFERENCES urunler(urun_id),
    FOREIGN KEY (siparisId) REFERENCES siparisler(siparis_id)
);



CREATE TABLE gecici_sepet (
  gecici_sepet_id INT AUTO_INCREMENT PRIMARY KEY,
  urunId INT NOT NULL,
  adet INT NOT NULL,
  eklenme_tarihi TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (urunId) REFERENCES urunler(urun_id)
);

CREATE TABLE kayitsiz_siparisler (
    kayitsiz_siparis_id INT AUTO_INCREMENT PRIMARY KEY,
    urunId INT NOT NULL,
    adet INT NOT NULL,
    siparis_tarihi DATETIME DEFAULT CURRENT_TIMESTAMP,
    musteri_adi VARCHAR(255), -- Kayıtsız kullanıcının adı
    musteri_soyadi VARCHAR(255), -- Kayıtsız kullanıcının soyadı
    musteri_tel VARCHAR(15), -- Kayıtsız kullanıcının telefon numarası
    musteri_email VARCHAR(255), -- Kayıtsız kullanıcının e-posta adresi
    musteri_adres TEXT, -- Kayıtsız kullanıcının teslimat adresi
    odeme_durumu varchar(40),
    FOREIGN KEY (urunId) REFERENCES urunler(urun_id)
);


-- personel_rol tablosunu oluştur
CREATE TABLE personel_rol (
    id INT AUTO_INCREMENT PRIMARY KEY,
    rol_adi VARCHAR(50) NOT NULL
);


-- admin tablosunu oluştur
CREATE TABLE admin (
    id INT AUTO_INCREMENT PRIMARY KEY,
    personel_adi VARCHAR(100) NOT NULL,
    personel_sifre VARCHAR(255) NOT NULL,
    rolId INT,
    FOREIGN KEY (rolId) REFERENCES personel_rol(id)
);

CREATE TABLE tedarikciler(
tedarikci_id int primary key auto_increment,
tedarikci_adi varchar(40),
tedarikci_soyadi varchar(40),
tedarikci_firma varchar(50),
tedarikci_tel varchar(40),
tedarikci_email varchar(40)
);

CREATE TABLE urun_tedarik_detay(
urunTedarik_id int primary key auto_increment,
urunId int,
tedarikciId int,
FOREIGN KEY (urunId) REFERENCES urunler(urun_id),
FOREIGN KEY (tedarikciId) REFERENCES tedarikciler(tedarikci_id)
);

CREATE TABLE personel(
personel_id int primary key auto_increment,
personel_adi varchar(100),
personel_soyadi varchar(100),
personel_sifre varchar(100),
personel_email varchar(100),
personel_tel varchar(100),
rolId int,
FOREIGN KEY (rolId) REFERENCES personel_rol(id)
);


CREATE TABLE markalar(
marka_id int primary key auto_increment,
marka_adi varchar(30)
);

CREATE TABLE modeller(
model_id int primary key auto_increment,
model_adi varchar(30)
);


-- ****************************SELECT

select * from stoklar;
select * from urunler;
select * from musteriler;
select * from siparisler;
select * from siparis_detay;
select * from sepet;
select * from gecici_sepet;
select * from kayitsiz_siparisler;
select * from personel;
select * from kategoriler;
select * from admin;
select * from tedarikciler;
select * from urun_tedarik_detay;
select * from markalar;
select * from modeller;
-- *******************ÇOKLU SORGU
select * from siparisler s 
JOIN siparis_detay sd ON (sd.siparisId=s.siparis_id)
JOIN urunler u ON (u.urun_id=sd.urunId)
JOIN musteriler m ON (m.musteri_id=s.musteriId)
WHERE musteri_id=?;





-- **************************DELETE

delete from stoklar;
alter table stoklar auto_increment=1;

delete from sepet;
alter table sepet auto_increment=1;

delete from gecici_sepet;
alter table gecici_sepet auto_increment=1;

delete from urunler;
alter table urunler auto_increment=1;

delete from musteriler;
alter table musteriler auto_increment=1;

delete from siparisler;
alter table siparisler auto_increment=1;

delete from siparis_detay;
alter table siparis_detay auto_increment=1;

delete from kayitsiz_siparisler;
alter table kayitsiz_siparisler auto_increment=1;

delete from admin;
alter table admin auto_increment=1;

delete from urun_tedarik_detay;
alter table urun_tedarik_detay auto_increment=1;

delete from tedarikciler;
alter table tedarikciler auto_increment=1;

delete from personel;
alter table personel auto_increment=1;

-- **************ÇEŞİTLİ KOMUTLAR

ALTER TABLE siparis_detay
MODIFY COLUMN birim_fiyat DECIMAL(10, 2) NOT NULL;
RENAME TABLE siparis_arsiv TO siparisler;
ALTER TABLE urunler ADD COLUMN indirimli_fiyat DECIMAL(10,2) DEFAULT NULL;
ALTER TABLE kayitsiz_siparisler ADD COLUMN toplam_fiyat decimal(10,2);
ALTER TABLE personel CHANGE COLUMN parsonel_adi personel_adi VARCHAR(100);
alter table sepet modify column siparisId INT;

-- ***************VERİ YÜKLEME
-- PERSONEL-ROL
INSERT INTO personel_rol (rol_adi) VALUES ('Yönetici'), ('Çalışan');

-- ADMIN
INSERT INTO admin (personel_adi, personel_sifre, rolId) VALUES ('Soner','soner123',1);


-- MARKALAR
INSERT INTO markalar (marka_adi) VALUES 
('Varta'), ('Bosch'), ('Mutlu'), ('İnci'), ('Castrol'), ('Mobil'),
('Shell'), ('Total'), ('Mann Filter'), ('Bosch Filter'), 
('UFI Filters'), ('Opet');


-- MODELLER
INSERT INTO modeller (model_adi) VALUES 
-- Ortak modeller (tek sefer eklenecek)
('60 Amper Akü'),
('72 Amper Akü'),
('5W40 Madeni Yağ'),
('10W40 Madeni Yağ'),
('Blue Dynamic'),        -- Varta
('S4 Battery'),          -- Bosch
('Silver Dynamic'),      -- Mutlu
('Formul A Taurus'),     -- İnci
('EDGE 5W-30'),          -- Castrol
('ESP X3 5W-30'),        -- Mobil
('Helix Ultra 5W-40'),   -- Shell
('Quartz 9000 Energy'),  -- Total
('CUK2939'),             -- Mann Filter
('P3317WS'),             -- Bosch Filter
('23.384.00'),           -- UFI Filters
('Fullmax 5W-40');       -- Opet


-- KATEGORİLER
INSERT INTO kategoriler (kategori_adi) VALUES ("Akü"),("Madeni Yağ"),("Filtre");

-- TEDARİKÇİLER
INSERT INTO tedarikciler (tedarikci_id, tedarikci_adi, tedarikci_soyadi, tedarikci_firma, tedarikci_tel, tedarikci_email) VALUES
(1, 'Murat', 'Petrol', 'Petrolium Yağları A.Ş.', '05551112233', 'murat.petrol@petroliumyasanal.com'),
(2, 'Cem', 'Akücü', 'Akü Master Şarj Sistemleri', '05552223344', 'cem.akucu@akumaster.com.tr'),
(3, 'Aylin', 'Filtre', 'Filtre Teknik Sanayi', '05553334455', 'aylin.filtre@filtrteknik.com'),
(4, 'Burak', 'Motor', 'Motor Yağları Ltd. Şti.', '05554445566', 'burak.motor@motoryaglari.com'),
(5, 'Deniz', 'Akdeniz', 'Akdeniz Akü ve Batarya', '05555556677', 'deniz.akdeniz@akdenizaku.com'),
(6, 'Ebru', 'Yağsan', 'Yağsan Madeni Yağlar', '05556667788', 'ebru.yagsan@yagsan.com.tr'),
(7, 'Faruk', 'Filtreş', 'Filtreş Otomotiv', '05557778899', 'faruk.filtres@filtresoto.com'),
(8, 'Gizem', 'Lubri', 'Lubri-Tech Yağlama Sistemleri', '05558889900', 'gizem.lubri@lubritech.com'),
(9, 'Hakan', 'Powerbat', 'Powerbat Akü Teknolojileri', '05559990011', 'hakan.power@powerbat.com.tr'),
(10, 'Irmak', 'Oilmax', 'Oilmax Endüstriyel Yağlar', '05550001122', 'irmak.oil@oilmax.com.tr');


